<html>
<body>
<style>
    html,body{ margin:0px; padding:0px; border:0px;}
    .tl-ui-tabs{ background:whitesmoke }
    .tl-ui-tabs a{ font:bold 14px 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height:30px; padding:0px 10px; color:#666 }
</style>
<div style="">
    <div class="tl-ui-tabs" style="background:whitesmoke;border-top:1px solid silver;border-bottom:1px solid lightgray"><a href="javascript:void(0)">Elements</a></div>
    <div class="clear" style="position:relative;height:100%;right:0px;left:0px;z-index:9999;background-color:rgba(255,255,255,.2);">
        <div id="left" class="tl-ui-scroll" style="width:70%;height:100%;float:left;"></div>
        <div id="right" class="tl-ui-scroll" style="width:30%;height:100%;float:left;box-shadow:inset 1px 0px 0px silver;"></div>
    </div>
</div>
<script src="PipeDevtool.js"></script>
<script src="tl.ui.AttrTable.js"></script>
<script src="tl.ui.TreeList.js"></script>
<script>
    var pipeDevtool = new PipeDevtool();
    pipeDevtool.init();
    pipeDevtool.onMessage = function(message){
        try{
            var f = eval(message.id);
            f.apply(this, message.data);
        }catch(e){ console.log(e) }
    };
    
    // ----------------
    
    var global = this;
    var tt, at, ie;
    
    // InspectElement Proxy
    ie.draw_rect = function(){ pipeDevtool.send({id:'ie.draw_rect', data:arguments}); }
    ie.clear_rect = function(){ pipeDevtool.send({id:'ie.clear_rect', data:arguments}); }
    ie.modify_node = function(){ pipeDevtool.send({id:'ie.modify_node', data:arguments}); }
    
    
    tt = new global['tl.ui.TreeList'](document.getElementById('left'));
    tt.on_hover = tt.on_select = function(nd){
        nd && nd.__data && ie && ie.draw_rect(nd.__data.id);
    };
    tt.on_out = function(){
        ie && ie.clear_rect();
    };
    tt.on_select = function(nd){
        nd && nd.__data && at && at.update(nd.__data.attr);
    };
    
    at = new global['tl.ui.AttrTable'](document.getElementById('right'));
    at.on_change = function(nd, attr, value){
        if (tt.selected){
            var attr_obj = {};// write an object for set attribute
            attr_obj[attr] = value;
            tt.selected.__data.attr[attr] = value; // set the tree data
            ie.modify_node(tt.selected.__data.id, attr_obj); // set the canvas
        }
    };
</script>
</body>
</html>